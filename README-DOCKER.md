# Executor Balancer - Docker Setup

## üê≥ –ó–∞–ø—É—Å–∫ —Å Docker Compose

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd executor-balancers

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up --build -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

- **Executor Balancer API**: http://localhost:8006/
- **PostgreSQL**: localhost:5432
- **Redis**: localhost:6379

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```yaml
services:
  postgres:     # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  redis:        # –ö—ç—à Redis
  executor-balancer:  # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  nginx:        # Reverse proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
DATABASE_URL=postgresql://postgres:password@postgres:5432/executor_balancer
REDIS_URL=redis://redis:6379
USE_DATABASE=true
DEBUG=true
```

### –ü–æ—Ä—Ç—ã

- **8006** - –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **5432** - PostgreSQL
- **6379** - Redis
- **80/443** - Nginx (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)

## üìã –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f executor-balancer

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose restart executor-balancer

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
docker-compose down -v

# –°–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
docker-compose build --no-cache
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

```bash
# –ß–µ—Ä–µ–∑ Docker
docker-compose exec postgres psql -U postgres -d executor_balancer

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –ø–æ—Ä—Ç –ø—Ä–æ–±—Ä–æ—à–µ–Ω)
psql -h localhost -p 5432 -U postgres -d executor_balancer
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis

```bash
# –ß–µ—Ä–µ–∑ Docker
docker-compose exec redis redis-cli

# –õ–æ–∫–∞–ª—å–Ω–æ
redis-cli -h localhost -p 6379
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost:8006/health

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs executor-balancer
```

### –ú–µ—Ç—Ä–∏–∫–∏

- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8006/docs
- **–î–∞—à–±–æ—Ä–¥**: http://localhost:8006/dashboard
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: http://localhost:8006/api/stats

## üöÄ Production

### –° Nginx

```bash
# –ó–∞–ø—É—Å–∫ —Å Nginx
docker-compose --profile production up -d
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose up --scale executor-balancer=3 -d
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker-compose exec executor-balancer bash

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec executor-balancer env
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
executor-balancers/
‚îú‚îÄ‚îÄ docker-compose.yml      # –û—Å–Ω–æ–≤–Ω–æ–π compose —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ Dockerfile             # Dockerfile –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ executor_balancer_api.py  # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ app/                   # –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ static/               # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ templates/            # HTML —à–∞–±–ª–æ–Ω—ã
‚îú‚îÄ‚îÄ requirements.txt      # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ start-docker.sh       # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
```

## ‚ùó –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PostgreSQL
docker-compose exec postgres pg_isready -U postgres

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ë–î
docker-compose restart postgres
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Redis

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
docker-compose exec redis redis-cli ping

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
docker-compose exec redis redis-cli FLUSHALL
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
docker-compose down -v
docker system prune -a
```